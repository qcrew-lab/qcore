"""DO NOT EDIT THIS FILE WHILE THE 'COAX_TEST_CAVITY' MEASUREMENT SETUP REMAINS UNCHANGED"""
"""This file initializes instruments that are part of the measurement setup ("stage")"""

import sys
from importlib import reload
from importlib.util import resolve_name

# import Instrument classes from the codebase
from qcrew.codebase.instruments import LabBrick, QuantumElement

# import qm
from qm.QuantumMachinesManager import QuantumMachinesManager

config_module_path = resolve_name(
    ".configuration", "qcrew.experiments.coax_test_cavity.imports"  ##xiaozhou
)
if config_module_path not in sys.modules:
    import qcrew.experiments.coax_test_cavity.imports.configuration as cfg  ##xiaozhou
else:
    reload(cfg)


########################################################################################
########################################################################################
config = cfg.config
qubit_IF = cfg.qubit_IF
qubit_LO = cfg.qubit_LO
rr_IF = cfg.rr_IF
rr_LO = cfg.rr_LO
cavity_IF = cfg.cavity_IF
cavity_LO = cfg.cavity_LO
qubit_mixer_offsets = cfg.qubit_mixer_offsets
rr_mixer_offsets = cfg.rr_mixer_offsets
cavity_mixer_offset = cfg.cavity_mixer_offsets

########################################################################################
########################################################################################

# initialize mixer_qubit, qubit and the qubit's LO
mixer_qubit = QuantumElement(
    name="mixer_qubit",
    i_offset=qubit_mixer_offsets["I"],
    q_offset=qubit_mixer_offsets["Q"],
    gain_offset=qubit_mixer_offsets["G"],
    phase_offset=qubit_mixer_offsets["P"],
)
qubit = QuantumElement(
    name="qubit", lo_freq=qubit_LO, int_freq=qubit_IF, mixer=mixer_qubit
)
lb_qubit = LabBrick(name="lb_qubit", serial_number=25331, frequency=qubit_LO, power=15)

########################################################################################
########################################################################################

# initialize mixer_rr, rr and the rr's LO
mixer_rr = QuantumElement(
    name="mixer_rr",
    i_offset=rr_mixer_offsets["I"],
    q_offset=rr_mixer_offsets["Q"],
    gain_offset=rr_mixer_offsets["G"],
    phase_offset=rr_mixer_offsets["P"],
)
rr = QuantumElement(name="rr", lo_freq=rr_LO, int_freq=rr_IF, mixer=mixer_rr)
lb_rr = LabBrick(name="lb_rr", serial_number=25335, frequency=rr_LO, power=15)


# initialize mixer_cavity, cavity and the cavity's LO
mixer_cavity = QuantumElement(
    name="mixer_cavity",
    i_offset=cavity_mixer_offset["I"],
    q_offset=cavity_mixer_offset["Q"],
    gain_offset=cavity_mixer_offset["G"],
    phase_offset=cavity_mixer_offset["P"],
)
cavity = QuantumElement(
    name="cavity", lo_freq=cavity_LO, int_freq=cavity_IF, mixer=mixer_cavity
)
lb_cavity = LabBrick(
    name="lb_cavity", serial_number=25332, frequency=cavity_LO, power=15
)


########################################################################################
########################################################################################

# initialize QM with the updated config file
qmm = QuantumMachinesManager()
qm = qmm.open_qm(config)

########################################################################################
########################################################################################
